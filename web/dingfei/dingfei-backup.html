<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width =device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone =no" name="format-detection" />
    <title>中秋顶费</title>
    <meta charset="utf-8" />
    <link href="http://code.jquery.com/mobile/git/jquery.mobile-git.css" rel="stylesheet" />

    <style>
        body { text-shadow: none !important; }
        .clearfix:after { content: "."; display: block; height: 0px; clear: both; visibility: hidden; }
        .ui-overlay-a, .ui-page-theme-a, .ui-page-theme-a .ui-panel-wrapper { background: #fff; text-shadow: none !important; }
        #canvas { text-align: center; }
            #canvas > div { left: 0; top: 0; overflow: hidden !important; }
        .sharePage { background: url("http://img10.360buyimg.com/cms/jfs/t2311/142/308287642/2891/a2a35651/55ffccc3N77870c67.png"); height: 100%; position: absolute; width: 100%; padding: 0; }
        .priceWrap { height: 20%; margin-top: 15%; background: url("http://img10.360buyimg.com/cms/jfs/t1894/322/341513896/21996/d6e8e828/55ffcd3fN8305382e.png") center; background-size: 100% 100%; color: #fff; font-size: 2em; text-align: center; line-height: 1em; }
            .priceWrap h1 { display: inline-block; }
        .shareContent { text-align: center; color: #fff; line-height: 2em; margin-top: 2em; }
            .shareContent b, .shareContent span { color: #ffc000; font-size: 1.3em; margin: 0 0.2em; }
        .btusWrap { text-align: center; margin: 1em auto; }
            .btusWrap input { width: 42%; height: 2em; border: 0; padding: 0; border-radius: 2em; font-size: 1.5em; font-weight: bold; }
                .btusWrap input:first-child { background: #cd0208; color: #fef800; }
                .btusWrap input:last-child { background: #fff; color: #cd0208; }
        .shareList { color: #a58586; list-style: none; margin: 0; padding: 0; background: rgba(0,0,0,0.6); width: 90%; margin-left: 5%; height: 35%; overflow: auto; font-size: 0.9px; }
            .shareList li { margin: 0; width: 90%; margin-left: 5%; float: left; line-height: 1.4em; padding: 0.3em 0; border-bottom: solid 1px #60282a; }
            .shareList div { float: left; width: 50%; }
                .shareList div:last-child { line-height: 3em; }
                .shareList div span { color: #733638; font-size: 0.8em; }
        #share_weak { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8) url("http://img13.360buyimg.com/cms/jfs/t1279/14/507220590/16193/6ae004a5/5582748bN68c1aad8.png") no-repeat; background-size: 100% 40%; display: none; }
        #phone_validate { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; }
            #phone_validate > div { position: absolute; background: url(http://img14.360buyimg.com/cms/jfs/t2449/294/339079711/269156/db6d481f/55ffcf27Nf9e2f066.png); width: 100%; height: 22em; background-size: 100% 100%; top: 50%; margin-top: -11em; text-align: center; }
                #phone_validate > div > div { position: absolute; bottom: 2em; width: 100%; }
                #phone_validate > div input[type="text"] { border: 0; height: 2.5em; font-size: 18px; border-radius: 2.5em; background: #dbb27e; box-shadow: inset 0.08em 0.08em 0.2em #666; color: #333; text-indent: 0.5em; outline: none; }
                #phone_validate > div button { border: 0; height: 2.5em; font-size: 18px; border-radius: 2.5em; background: #cd0208; color: #fef800; }
                    #phone_validate > div button:first-child { width: 50%; }
    </style>
</head>
<body>
    <!--<div data-role="page" id="result">
        <div data-role="content">
            
        </div>
    </div>-->
    <div data-role="page" id="game">
        <div data-role="content">
            <div id="canvas">
                <img src="http://img14.360buyimg.com/cms/jfs/t865/49/1034073230/6017/6f27d16f/556c0030N1f282f1f.gif" />
            </div>
        </div>
    </div>
    <div data-role="page" id="share">
        <div data-role="content" class="sharePage">
            <div class="priceWrap">
                ￥<h1>50</h1>元
            </div>
            <div class="shareContent">
                吓死本宝宝了！你在10s内一共顶了 <strong id="hitCount">70</strong> 次金币<br />
                <span>手速击败了82%的全国人民</span><br />
                可获得<b>8</b>元话费充值优惠券
            </div>
            <div class="btusWrap">
                <input type="button" id="btu_share" data-role="none" value="分享领卷"/>
                <input type="button" id="btu_again" data-role="none" value="再玩一次" />
            </div>
            <ul class="shareList clearfix">
                <li>
                    <div>其***<br/><span>2015-01-20 20:32</span></div>
                    <div>手机充值优惠券5元</div>
                </li>
                <li>
                    <div>其***<br /><span>2015-01-20 20:32</span></div>
                    <div>手机充值优惠券5元</div>
                </li>
                <li>
                    <div>其***<br /><span>2015-01-20 20:32</span></div>
                    <div>手机充值优惠券5元</div>
                </li>
                <li>
                    <div>其***<br /><span>2015-01-20 20:32</span></div>
                    <div>手机充值优惠券5元</div>
                </li>
                <li>
                    <div>其***<br /><span>2015-01-20 20:32</span></div>
                    <div>手机充值优惠券5元</div>
                </li>
            </ul>
        </div>
        <div id="share_weak"></div>
        <div id="phone_validate">
            <div>
                <div>
                    <input data-role="none" id="input_phone" style="margin-top:40%;width:75%" type="text" placeholder="请输入手机号码" /><br />
                    <input data-role="none" style="margin-top:1em;width:38%" type="text" placeholder="请输入验证码" />
                    <button data-role="none" id="btu_phoneCode" style="width:35%">获取验证码</button><br />
                    <button data-role="none" style="width:75%;margin-top:1em;font-weight:bold">领取</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
<script src="http://lufylegend.com/js/lufylegend-1.9.10.min.js"></script>
<script>
    $(function () {
        $.mobile.defaultPageTransition = "slide";
        //$("#link").bind("tap", function () {
        //    $.mobile.changePage("#game", "slide");
        //});
        $("#btu_again").tap(function () {
            $.mobile.changePage("#game");
            gameStart();
        });
        //游戏分享
        $("#btu_share").click(function () {
            $("#share_weak").fadeIn();
        });
        $("#share_weak").click(function () {
            $(this).fadeOut();
            $("#phone_validate").fadeIn();
        });
    });
    

    function seriesLoadScripts(scripts, callback) {
        if (typeof (scripts) != "object") var scripts = [scripts];
        var HEAD = document.getElementsByTagName("head").item(0) || document.documentElement;
        var s = new Array(), last = scripts.length - 1, recursiveLoad = function (i) {  //递归
            s[i] = document.createElement("script");
            s[i].setAttribute("type", "text/javascript");
            s[i].onload = s[i].onreadystatechange = function () { //Attach handlers for all browsers
                if (!/*@cc_on!@*/0 || this.readyState == "loaded" || this.readyState == "complete") {
                    this.onload = this.onreadystatechange = null; this.parentNode.removeChild(this);
                    if (i != last) recursiveLoad(i + 1); else if (typeof (callback) == "function") callback();
                }
            }
            s[i].setAttribute("src", scripts[i]);
            HEAD.appendChild(s[i]);
        };
        recursiveLoad(0);
    } var pingyu = "";


    (function (exp) {
        exp.onresize = function () { LGlobal.resize(); }
        LGlobal.destroy = true; //保证游戏中的不用的对象能够顺利被释放
        LGlobal.preventDefault = false;
        LGlobal.align = LStageAlign.BOTTOM_MIDDLE;
        var moneyText, raminTime, moneyBox, joy;//钱,时间
        var gameTime = 10;
        
        var shareInfoFactory = {
            hitCount:0,
            data: [
                { len: { min: 0, max: 10 }, info: "你敢再慢点么！你在10s内一共顶了N次金币<br /><span>手速已经在全国用户中垫底了</span><br />可获得<b>6</b>元话费充值优惠券", money: 6 },
                { len: { min: 10, max: 20 }, info: "你可以更快的！你在10s内一共顶了N次金币<br /><span>手速击败了 60% 的全国用户</span><br />可获得<b>7</b>元话费充值优惠券", money: 7 },
                { len: { min: 20, max: 25 }, info: "哎呦，不错呦！你在10s内一共顶了N次金币<br /><span>手速击 70% 的全国用户</span><br />可获得<b>8</b>元话费充值优惠券", money: 8 },
                { len: { min: 25, max: 30 }, info: "单身20年的手速！你在10s内一共顶了N次金币<br /><span>手速击败了 80% 的全国用户</span><br />可获得<b>9</b>元话费充值优惠券", money: 9 },
                { len: { min: 30, max: 1000 }, info: "吓死本宝宝了！你在10s内一共顶了N次金币<br /><span>手速击败了 90% 的全国用户</span><br />可获得<b>10</b>元话费充值优惠券", money: 10 }
            ],
            get: function (count) {
                this.hitCount = count;
                for (var i = 0; i < this.data.length; i++) {
                    var _data = this.data[i];
                    console.log(count);
                    if (_data.len.min <= count && count < _data.len.max) {
                        //var _str = new String(_data.info);
                        var _info = _data.info.replace(/N/g, count);
                        var outData = jQuery.extend({},_data, { info: _info });
                        return outData;
                    }
                }
                return this.data[0];
            }
        }
        var isRuning = false;
        //获取随机数
        exp.getRedom = function (minNum, maxNum) {
            switch (arguments.length) {
                case 1: return parseInt(Math.random() * minNum + 1);
                case 2: return parseInt(Math.random() * (maxNum - minNum + 1) + minNum);
                default: return 0;
            }
        }
        LSprite.prototype.align = function () { this.x = (LGlobal.width - this.getWidth()) / 2; }//居中
        LButton.prototype.align = function () { this.x = (LGlobal.width - this.getWidth()) / 2; }//居中
        var imgData = new Array(
            { name: "price_bg", path: "http://img10.360buyimg.com/cms/jfs/t1894/322/341513896/21996/d6e8e828/55ffcd3fN8305382e.png" },
            { name: "page_bg", path: "http://img10.360buyimg.com/cms/jfs/t2311/142/308287642/2891/a2a35651/55ffccc3N77870c67.png" },
            { name: "bg", path: "http://img12.360buyimg.com/cms/jfs/t2410/58/330414902/100793/243a1c45/55ffcc64N043a04d5.png" },
            { name: "btu_1", path: "http://img14.360buyimg.com/cms/jfs/t1774/267/1659266019/7497/77132ad5/55ffcc84N10be9d3e.png" },
            { name: "btu_1_hover", path: "http://img13.360buyimg.com/cms/jfs/t2026/90/320075934/7495/72fb6abe/55ffcc84Nfd3d6e0f.png" },
            { name: "game_bg", path: "http://img12.360buyimg.com/cms/jfs/t2026/83/346033562/11263/2a59af22/55ffcc84Ncc9fb65b.png" },
            { name: "floor", path: "http://img10.360buyimg.com/cms/jfs/t2056/169/330444264/101608/dad9b658/55ffcc85Nff3b454e.png" },
            { name: "headerWrap", path: "http://img11.360buyimg.com/cms/jfs/t1825/234/1624837473/5635/a7c3de0f/55ffcc84Nb4370cf0.png" },
            { name: "moneyBox", path: "http://img13.360buyimg.com/cms/jfs/t2068/231/303253281/11742/aa7a5d67/55ffccc3Nc09b89be.png" },
            { name: "joy_1", path: "http://img12.360buyimg.com/cms/jfs/t2047/219/320487950/16764/e0e7a97c/55ffccc3N6ea62c68.png" },
            { name: "joy_2", path: "http://img12.360buyimg.com/cms/jfs/t1762/151/1625848058/12380/8612b664/55ffccc3Ne892ad6c.png" },
            { name: "joy_3", path: "http://img14.360buyimg.com/cms/jfs/t1828/242/1651296075/11208/e212d611/55ffccc3N7fb7d37c.png" });

        function main() {
            LGlobal.stageScale = LStageScaleMode.EXACT_FIT;
            LSystem.screen(LStage.FULL_SCREEN);
            backLayer = new LSprite();
            backLayer.graphics.drawRect(1, "#cccccc", [0, 0, LGlobal.width, LGlobal.height], true, "#000000");
            //背景显示
            addChild(backLayer);
            loadingLayer = new LoadingSample1();
            backLayer.addChild(loadingLayer);

            LLoadManage.load(imgData, function (progress) {
                //document.getElementById("loadingBg_div").innerHTML = progress + "%";
                loadingLayer.setProgress(progress);
            }, gameInit);
        }
        //读取完所有图片，进行游戏标题画面的初始化工作
        function gameInit(result) {
            //取得图片读取结果
            imglist = result;
            //移除进度条层//移除或者这样写 loadingLayer.remove();
            backLayer.removeChild(loadingLayer);
            //加入欢迎页
            backLayer.addChild(initPages.indexPage());
            backLayer.addEventListener(LEvent.ENTER_FRAME, function () { });

        }
        //加载界面
        var initPages = {
            indexPage: function () {
                var returnPage = new LSprite();
                returnPage.addChild(new LBitmap(new LBitmapData(imglist["bg"])));
                //加入按钮
                var button = new LButton(new LBitmap(new LBitmapData(imglist["btu_1"])), new LBitmap(new LBitmapData(imglist["btu_1"])));
                button.align(); 
                button.y = 740;
                button.addEventListener(LMouseEvent.MOUSE_UP, function () {
                    gameStart();
                });
                //加入查看活动按钮
                var btu = new LSprite();
                var link = new LTextField();
                link.text = "查看活动规则"; link.size = 20; link.color = "#ffffff";
                btu.addChild(link);
                btu.align();
                btu.y = 950;
                btu.addEventListener(LMouseEvent.MOUSE_UP, function () {
                    alert("打开规则");
                });
                returnPage.addChild(button);
                returnPage.addChild(btu);
                return returnPage;
            },
            gamePage: function () {
                var returnPage = new LSprite();
                var bg = new Background();
                returnPage.addChild(bg);//背景

                var floor = new LBitmap(new LBitmapData(imglist["floor"]));
                floor.y = LGlobal.height - floor.getHeight();
                returnPage.addChild(floor);//草地
                returnPage.addChild(new LBitmap(new LBitmapData(imglist["headerWrap"])));//顶部
                moneyText = new LTextField();
                moneyText.text = "0"; moneyText.size = 32; moneyText.color = "#ffc000"; moneyText.x = 120; moneyText.y = 10;
                raminTime = new LTextField();
                raminTime.text = "10'00''"; raminTime.size = 32; raminTime.color = "#ffc000"; raminTime.x = 500; raminTime.y = 10;
                returnPage.addChild(moneyText);//钱
                returnPage.addChild(raminTime);//时间
                moneyBox = new MoneyBox();
                returnPage.addChild(moneyBox);
                joy = new Joy();
                returnPage.addChild(joy);
                returnPage.addEventListener(LEvent.ENTER_FRAME, function () {
                    bg.run(); moneyBox.run(); joy.run();
                    if (LGlobal.hitTestRect(moneyBox, joy)) {
                        moneyBox.hit(); joy.hit();
                    }
                });
                returnPage.addEventListener(LMouseEvent.MOUSE_DOWN, function () {
                    if (isRuning == false&&joy.state!=1) {
                        isRuning = true;
                        var _gameTime = gameTime;
                        raminTime.text = _gameTime + "'00''";
                        var timer = window.setInterval(function () {
                            _gameTime--;
                            if (_gameTime < 0) {
                                joy.state = 2;
                                joy.setView();
                                isRuning = false;
                                window.clearInterval(timer);
                                raminTime.x = 500;
                            }
                        }, 1000);

                        var stime = 60;
                        var timer2 = window.setInterval(function () {
                            stime--;
                            if (_gameTime == 0) {
                                raminTime.text = "0'" + stime + "''";
                                if (stime == 0) {
                                    window.clearInterval(timer2);
                                    returnPage.die();
                                    gameOver();
                                }
                            } else {
                                raminTime.text = _gameTime + "'" + stime + "''";
                            }

                            if (stime == 0) { stime = 60; }
                        }, 10);
                    }
                    if (joy.state == 2 && isRuning == true) {
                        joy.state = 3;
                        joy.setView();
                    }
                });
                returnPage.addEventListener(LMouseEvent.MOUSE_UP, function () { });
                return returnPage;
            }
        }

        //游戏开始
        exp.gameStart = function () {
            backLayer.die();
            backLayer.removeAllChild();
            backLayer.addChild(initPages.gamePage());
        }
        function onframe() {
            if (!isStop) {

            }
        }

        //游戏暂停,显示结果
        var gamePause = function () {

        }
        //游戏结束
        var gameOver = function (type, food) {
            //alert("游戏结束");
            //console.log(moneyText.text);
            var _si = shareInfoFactory.get(parseInt(moneyText.text));
            console.log(_si.info);
            $(".shareContent").html(_si.info);
            //console.log(_si.info);
            window.setTimeout(function () {
                //console.log(_si.info);
                $.mobile.changePage("#share", "slide");
            }, 1000);
        }
        function MoneyBox() {
            base(this, LSprite, []);
            var self = this;
            self.setView();
        }
        MoneyBox.prototype.setView = function () {
            var self = this;
            self.addChild(new LBitmap(new LBitmapData(imglist["moneyBox"])));
            self.align(); self.y = 250;
        }
        MoneyBox.prototype.state = 1;
        MoneyBox.prototype.run = function () {
            var _self = this;
            switch (_self.state) {
                case 1:
                    _self.y = 250;
                    break;
                case 2:
                    //上升
                    _self.y -= 5;
                    if (_self.y <= 240) {
                        _self.state = 3;
                    }
                    break;
                case 3:
                    //回落
                    _self.y += 5;
                    if (_self.y >= 250) {
                        _self.state = 1;
                    }
                    break;
            }
        }
        MoneyBox.prototype.hit = function () {
            var money1 = new LTextField();
            money1.text = "+1"; money1.size = 44; money1.color = "#ffc000";
            money1.x = (this.getWidth() - money1.getWidth()) / 2;
            money1.y = -40;
            //money1.x = (LGlobal.width - this.getWidth()) / 2; money1.y = this.y;
            this.addChild(money1);
            var tween = LTweenLite.to(money1, 0.8, {
                y: -150, alpha: 0, loop: false, ease: LEasing.Sine.easeOut, onComplete: function () { }
            });
            var moneyValue = parseInt(moneyText.text);
            //alert(moneyValue);
            moneyText.text = ++moneyValue;
            if (moneyValue == 10) { moneyText.x -= 16; } else if (moneyValue == 20) { moneyText.x = 109; }
            this.state = 2;
        }

        function Joy() {
            base(this, LSprite, []);
            var self = this;
            self.setView();
        }
        Joy.prototype.setView = function () {
            var _self = this;
            _self.removeAllChild();
            switch (_self.state) {
                case 1:
                    _self.y = 580;
                    _self.addChild(new LBitmap(new LBitmapData(imglist["joy_1"])));
                    break;
                case 2:
                    _self.y = 580;
                    _self.addChild(new LBitmap(new LBitmapData(imglist["joy_2"])));
                    break;
                case 3:
                    _self.addChild(new LBitmap(new LBitmapData(imglist["joy_3"])));
                    break;
                case 4:
                    _self.addChild(new LBitmap(new LBitmapData(imglist["joy_3"])));
                    break;
            }
        }
        Joy.prototype.state = 1;
        Joy.prototype.weight = 0.93;
        Joy.prototype.run = function () {
            var _self = this;
            switch (_self.state) {
                case 1:
                    var _x = (LGlobal.width - _self.getWidth()) / 2 + 10;
                    if (_self.x >= _x) {
                        _self.state = 2;
                        _self.setView();
                    } else {
                        _self.x += 5;
                    }
                    break;
                case 2://预备状态
                    _self.x = _self.x;
                    break;
                case 3://起跳状态
                    if (_self.y <= moneyBox.y) {
                        _self.state = 4;
                        _self.setView();
                    }
                    _self.y = _self.y * _self.weight * 0.98;
                    break;
                case 4://下落状态
                    if (_self.y >= 570) {
                        _self.state = 2;
                        _self.setView();
                    } else {
                        _self.y = _self.y * _self.weight * 1.17;
                    }
                    break;
            }
        }
        Joy.prototype.hit = function () {
            this.state = 4;
        }

        function Background() {
            base(this, LSprite, []);
            var self = this;
            self.setView();
        }
        Background.prototype.setView = function () {
            var self = this;
            var bg1 = new LSprite(); var bg2 = new LSprite();
            bg1.addChild(new LBitmap(new LBitmapData(imglist["game_bg"])));
            bg2.addChild(new LBitmap(new LBitmapData(imglist["game_bg"])));
            bg2.x = LGlobal.width;
            self.addChild(bg1); self.addChild(bg2);
        }
        Background.prototype.speed = 2;
        Background.prototype.run = function () {
            var _self = this;
            _self.x -= _self.speed;
            if (_self.x <= -LGlobal.width) {
                _self.x = 0;
            }
        }
        
        var loadImages = function (url, callBack) {
            var img = new Image(); //创建一个Image对象，实现图片的预下载
            img.onload = function () { img.onload = null; callBack(img); }
            img.src = url;
        }
        init(30, "canvas", 640, 1008, function () {
            main();
        });
    })(window);
    
    $.fn.phoneValidate = function (btu, option) {
        var _self = this;
        var getTime = function () {
            var time = _option.requestTime;
            btu.attr("disabled", true);
            btu.val(_option.requestText.replace("requestText", time));
            var timer = window.setInterval(function () {
                if (time == 1) {
                    btu.attr("disabled", false);
                    window.clearInterval(timer);
                    btu.val(_option.readyText);
                    return false;
                }
                btu.html(_option.requestText.replace("requestText", --time));
            }, 1000);
        }
        var _option = $.extend({
            readyText: "获取验证码",
            requestTime: 60,
            requestText: "获取验证码(requestText)",
            ajaxfn: undefined,
            ajaxUrl: "",
            callBack: function (data) { },
            error: function (data) { }
        }, option || {})

        btu.click(function () {
            if (_self.val() == "") return false;
            getTime();
            if (_option.ajaxfn) {
                ajaxfn.call(_self);
                return false;
            }
            if (_option.ajaxUrl == "") return false;
            $.ajax({
                type: post,
                url: _option.ajaxUrl,
                success: function (data) {
                    _option.callBack.call(_self, data);
                },
                error: function (data) {
                    _option.error.call(_self, data);
                }
            })
        });
    }
    $("#input_phone").phoneValidate($("#btu_phoneCode"));
</script>